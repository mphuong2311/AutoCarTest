(function(){"use strict";var t={5603:function(t,e,r){var n=r(7195),s=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("MainView")],1)},a=[],o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("b-tag",{attrs:{type:t.connected?"is-success":"is-danger"}},[t._v("Trạng thái kết nối: "+t._s(t.connected?"Connected":"Disconnected"))]),e("b-tag",{attrs:{type:"is-primary"}},[t._v("Trạng thái xe: "+t._s(t.statusCar))]),e("b-tag",{attrs:{type:"is-info"}},[t._v(" Điểm đến: "+t._s(t.nextGoal?t.nextGoal.title:"---"))]),e("hr"),e("OrderComponent",{attrs:{dataLocations:t.list,hasUpdate:t.hasUpdate}}),e("hr"),e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("b-field",[e("b-input",{attrs:{disabled:t.confirmCarAndOrder,placeholder:"Order ID"},model:{value:t.orderId,callback:function(e){t.orderId=e},expression:"orderId"}})],1)],1),e("div",{staticClass:"column"},[e("b-field",[e("b-input",{attrs:{disabled:t.confirmCarAndOrder,placeholder:"Car ID"},model:{value:t.carName,callback:function(e){t.carName=e},expression:"carName"}})],1)],1),e("div",{staticClass:"column"},[e("b-button",{attrs:{disabled:t.confirmCarAndOrder},on:{click:t.setCarAndOrder}},[t._v("Set")]),e("b-button",{attrs:{disabled:!t.confirmCarAndOrder||"WaitingForRoute"!==t.statusCar},on:{click:t.editCarAndOrder}},[t._v("Edit")])],1)]),e("hr"),t._l(t.list,(function(r){return e("b-button",{key:r._id,attrs:{disabled:!t.confirmCarAndOrder},on:{click:function(e){return t.sendGoal(r)}}},[t._v(t._s(r.title))])})),e("hr"),e("b-button",{attrs:{disabled:!t.confirmCarAndOrder||"WaitingForEngage"!==t.statusCar},on:{click:function(e){return t.sendEngage()}}},[t._v("Engage")]),e("hr")],2),e("div",{staticClass:"column"},[e("MapLocation",{attrs:{list:t.list,centerMap:t.centerMap,carGPS:t.carGPS}})],1)])},i=[],l=r(1318);const c=l.ZP.create({baseURL:"http://localhost:1221/v1",timeout:2e3});c.interceptors.request.use((t=>t),(t=>(console.log(t),Promise.reject(t)))),c.interceptors.response.use((t=>t),(t=>(console.log(t),Promise.reject(t))));var d=c;function u(t){return d({url:`/maps/${t}`,method:"get"})}function p(t,e){return d({url:`/orders/${t}`,method:"patch",data:e})}function f(t){return d({url:"/orders",method:"post",data:t})}function h(){return d({url:"/orders",method:"get"})}function m(t){return d({url:`/orders/${t}`,method:"delete"})}var b=r(7548),g=r.n(b),v=function(){var t=this,e=t._self._c;return e("l-map",{staticClass:"map",attrs:{options:t.mapOptions,zoom:t.zoom,center:t.centerMap}},[e("l-tile-layer",{attrs:{url:t.url,attribution:t.attribution}}),t._l(t.list,(function(r,n){return e("l-marker",{key:n,attrs:{"lat-lng":[r.lat,r.lng]}},["Station"==r.type?e("l-icon",[e("Station"),e("p",{class:"."!==r.title?"headline":"headline-2"},[t._v(" "+t._s("Station"==r.type?n+1+") ":"")+t._s(r.title)+" ")])],1):t._e()],1)})),e("l-marker",{attrs:{"lat-lng":t.carGPS}},[e("l-icon",[e("CarIcon")],1)],1)],2)},_=[];const y='&copy; <a target="_blank" href="http://osm.org/copyright">OpenStreetMap</a> contributors',k=[20.962179055697607,105.74755553303486],C="https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",O={zoomSnap:.5,zoomControl:!1,minZoom:12,maxZoom:18};var w=function(){var t=this,e=t._self._c;return e("svg",{staticClass:"fix",staticStyle:{"enable-background":"new 0 0 487.724 487.724"},attrs:{fill:t.color,height:t.height,version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 487.724 487.724","xml:space":"preserve"}},[e("g",[e("g",[e("path",{attrs:{d:"M236.925,0.124c-96.9,3.4-177.4,79-186.7,175.5c-1.9,19.3-0.8,38,2.6,55.9l0,0c0,0,0.3,2.1,1.3,6.1\n          c3,13.4,7.5,26.4,13.1,38.6c19.5,46.2,64.6,123.5,165.8,207.6c6.2,5.2,15.3,5.2,21.6,0c101.2-84,146.3-161.3,165.9-207.7\n          c5.7-12.2,10.1-25.1,13.1-38.6c0.9-3.9,1.3-6.1,1.3-6.1l0,0c2.3-12,3.5-24.3,3.5-36.9C438.425,84.724,347.525-3.776,236.925,0.124\n          z M243.825,291.324c-52.2,0-94.5-42.3-94.5-94.5s42.3-94.5,94.5-94.5s94.5,42.3,94.5,94.5S296.025,291.324,243.825,291.324z"}})])])])},x=[],S={name:"StationIcon",props:{color:{type:String,default:"gray"},height:{type:[String,Number],default:24}}},P=S,Z=r(713),G=(0,Z.Z)(P,w,x,!1,null,"cd652dca",null),$=G.exports,A=function(){var t=this,e=t._self._c;return e("svg",{staticClass:"car",attrs:{id:"Layer_1","data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64"}},[e("defs"),e("circle",{staticClass:"cls-1",attrs:{cx:"32",cy:"32",r:"32"}}),e("path",{staticClass:"cls-2",attrs:{d:"M49.51,16.26,37.86,30.14l-2.75-3.27a2.86,2.86,0,0,1,0-3.69L40,17.29a2.93,2.93,0,0,1,2.23-1Z"}}),e("path",{staticClass:"cls-2",attrs:{d:"M14.49,16.28,26.15,30.16l2.74-3.27a2.86,2.86,0,0,0,0-3.69L24,17.31a3,3,0,0,0-2.23-1Z"}}),e("path",{staticClass:"cls-3",attrs:{d:"M49.72,47.74H42.36a2.83,2.83,0,0,1-2.2-1l-7.61-9.06a.72.72,0,0,0-1.1,0l-7.61,9.06a2.87,2.87,0,0,1-2.21,1H14.28L27.65,31.81l2.09-2.5a3,3,0,0,1,4.51,0l2.1,2.5Z"}})])},M=[],U={name:"CarIcon"},I=U,L=(0,Z.Z)(I,A,M,!1,null,null,null),E=L.exports,D={name:"MapLocation",components:{Station:$,CarIcon:E},props:{list:{type:Array,default:()=>[]},centerMap:{type:Array,default:()=>k},carGPS:{type:Array,default:()=>k}},data(){return{zoom:18,mapOptions:O,attribution:y,url:C}}},T=D,N=(0,Z.Z)(T,v,_,!1,null,"82bd09f8",null),j=N.exports,z=function(){var t=this,e=t._self._c;return e("section",[e("section",{staticClass:"is-flex is-flex-direction-row is-justify-content-space-evenly"},[e("b-select",{attrs:{placeholder:"Pick up"},model:{value:t.pickUp,callback:function(e){t.pickUp=e},expression:"pickUp"}},t._l(t.dataLocations,(function(r){return e("option",{key:r._id,domProps:{value:r._id}},[t._v(" "+t._s(r.title)+" ")])})),0),e("b-select",{attrs:{placeholder:"Drop off"},model:{value:t.dropOff,callback:function(e){t.dropOff=e},expression:"dropOff"}},t._l(t.dataLocations,(function(r){return e("option",{key:r._id,domProps:{value:r._id}},[t._v(" "+t._s(r.title)+" ")])})),0),e("b-button",{on:{click:t.handleCreateOrder}},[t._v("Create order")])],1),e("br"),e("b-checkbox",{model:{value:t.showCompletedOrders,callback:function(e){t.showCompletedOrders=e},expression:"showCompletedOrders"}},[t._v(" Show completed orders ")]),e("b-table",{attrs:{data:t.orderList?t.orderList:[]}},[e("b-table-column",{attrs:{field:"id",label:"Order ID",centered:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row._id)+" ")]}}])}),e("b-table-column",{attrs:{field:"car",label:"Car",centered:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.car?._id||"-")+" ")]}}])}),e("b-table-column",{attrs:{field:"pickUp",label:"pickUp",centered:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.pickUp.title)+" ")]}}])}),e("b-table-column",{attrs:{field:"dropOff",label:"dropOff",centered:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.dropOff.title)+" ")]}}])}),e("b-table-column",{attrs:{field:"status",label:"Status",sortable:"",centered:""},scopedSlots:t._u([{key:"default",fn:function(r){return[e("span",{class:["tag",{"is-info":2===r.row.status},{"is-danger":0==r.row.status||1===r.row.status},{"is-success":4==r.row.status}]},[t._v(" "+t._s(r.row.status)+" ")])]}}])}),e("b-table-column",{attrs:{label:"Actions",centered:""},scopedSlots:t._u([{key:"default",fn:function(r){return[e("b-button",{attrs:{size:"is-small",type:"is-danger","icon-left":"delete"},on:{click:function(e){return t.handleDeleteOrder(r.row._id)}}},[t._v("Delete")])]}}])})],1)],1)},R=[],B={name:"CreateOrder",props:{dataLocations:{type:Array,default:()=>[]},hasUpdate:{type:Boolean,default:!1}},data(){return{pickUp:null,dropOff:null,order:null,orderList:[],showCompletedOrders:!1}},created(){this.fetchProcessingOrders()},watch:{hasUpdate(t,e){this.fetchProcessingOrders()},showCompletedOrders(t,e){t?this.fetchCompletedOrders():this.fetchProcessingOrders()}},sockets:{decline_order:function(){console.log("Don hang bi tu choi!"),this.fetchProcessingOrders()},accept_order(t){console.log(t),console.log("Co don hang moi!"),this.fetchProcessingOrders()}},methods:{fetchCompletedOrders(){h().then((t=>{this.$buefy.snackbar.open("Get completed orders!"),this.orderList=t.data.filter((t=>4==t.status))}))},fetchProcessingOrders(){h().then((t=>{this.$buefy.snackbar.open("Get processing orders!"),this.orderList=t.data.filter((t=>4!=t.status))}))},handleCreateOrder(){let t={map:"63eb08b653d65fd7e6792fca",pickUp:this.pickUp,dropOff:this.dropOff};f(t).then((t=>{this.$socket.emit("track_order",t.data._id),this.order=t.data,this.$buefy.snackbar.open("Created order successfully!"),this.showCompletedOrders?this.fetchCompletedOrders():this.fetchProcessingOrders()}))},handleDeleteOrder(t){m(t).then((()=>{this.$buefy.toast.open(`Delete ${t}`),this.showCompletedOrders?this.fetchCompletedOrders():this.fetchProcessingOrders()}))}}},F=B,V=(0,Z.Z)(F,z,R,!1,null,null,null),H=V.exports,W={name:"MainView",components:{MapLocation:j,OrderComponent:H},data(){return{list:[],ros:null,connected:null,topicGoal:null,topicEngage:null,topicStatus:null,statusCar:null,centerMap:[0,0],nextGoal:null,carGPS:[0,0],carName:this.$cookie.get("carName")||null,orderId:this.$cookie.get("orderId")||null,confirmCarAndOrder:null,arrivedGoalEvent:!1,hasUpdate:!1}},created(){this.fetchData(),this.connectRos()},sockets:{connect:function(){console.log("socket connected")}},watch:{arrivedGoalEvent(t,e){if(t){let t={car:this.carName,location:this.nextGoal._id};p(this.orderId,t).then((t=>{console.log(t.data),this.hasUpdate=!0,this.$buefy.snackbar.open("PATCH to server!")})),this.hasUpdate=!1}}},methods:{connectRos(){this.ros=new(g().Ros)({url:"ws://0.0.0.0:9090"}),this.ros.on("connection",(()=>{this.$buefy.snackbar.open("ROS Connected!"),this.connected=!0,this.setTopic(),this.$buefy.snackbar.open("Set topic!"),this.topicStatus=new(g().Topic)({ros:this.ros,name:"/awapi/vehicle/get/status",messageType:"autoware_api_msgs/AwapiVehicleStatus"}),this.topicStatus.subscribe((t=>{this.statusCar=t.autoware_state,this.carGPS=[t.latlon.lat,t.latlon.lon],"ArrivedGoal"==this.statusCar?this.arrivedGoalEvent=!0:this.arrivedGoalEvent=!1}))})),this.ros.on("error",(()=>{this.$buefy.snackbar.open("ROS Error!")}))},fetchData(){u("63eb08b653d65fd7e6792fca").then((t=>{this.$buefy.snackbar.open("Get map & location successfully!"),this.centerMap=[t.data.center.lat,t.data.center.lng],this.list=t.data.locations.filter((t=>"Station"==t.type&&"Release"==t.status))}))},setTopic(){this.topicGoal=new(g().Topic)({ros:this.ros,name:"/planning/mission_planning/mission_planner/input/llh_goal",messageType:"sensor_msgs/NavSatFix"}),this.topicEngage=new(g().Topic)({ros:this.ros,name:"/autoware/engage",messageType:"std_msgs/Bool"})},sendGoal(t){let e=new(g().Message)({latitude:t.lat,longitude:t.lng,altitude:t.atl});this.topicGoal.publish(e),this.$buefy.snackbar.open(`Đã gửi cho xe điểm đến ${t.title}`),this.nextGoal=t},sendEngage(){this.topicEngage.publish(new(g().Message)({data:!0})),this.$buefy.snackbar.open("Sent engage!")},setCarAndOrder(){this.confirmCarAndOrder=!0,this.$cookie.set("carName",this.carName),this.$cookie.set("orderId",this.orderId),this.$buefy.snackbar.open("Set car and order!")},editCarAndOrder(){this.confirmCarAndOrder=!1,this.$buefy.snackbar.open("Edit car and order!")}}},q=W,J=(0,Z.Z)(q,o,i,!1,null,"1d31b166",null),K=J.exports,Q={name:"App",components:{MainView:K}},X=Q,Y=(0,Z.Z)(X,s,a,!1,null,null,null),tt=Y.exports,et=r(7133),rt=(r(387),r(185)),nt=r(4761),st=r(3685),at=r(8446),ot=r(8074),it=r(8145);const lt="ws://localhost:1221",ct={debug:!0,connection:lt,options:{withCredentials:!0}};var dt=r(5624),ut=r.n(dt);n.ZP.config.productionTip=!1,n.ZP.use(et.ZP,{defaultIconPack:"mdi"});var pt=r(2245);n.ZP.use(pt),n.ZP.component("l-map",rt.Z),n.ZP.component("l-tile-layer",nt.Z),n.ZP.component("l-marker",st.Z),n.ZP.component("l-icon",at.Z),n.ZP.component("l-rectangle",ot.Z),delete it.Icon.Default.prototype._getIconUrl,it.Icon.Default.mergeOptions({iconRetinaUrl:r(6431),iconUrl:r(7093),shadowUrl:r(8858)}),n.ZP.use(new(ut())(ct)),new n.ZP({render:t=>t(tt)}).$mount("#app")}},e={};function r(n){var s=e[n];if(void 0!==s)return s.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,r),a.exports}r.m=t,function(){var t=[];r.O=function(e,n,s,a){if(!n){var o=1/0;for(d=0;d<t.length;d++){n=t[d][0],s=t[d][1],a=t[d][2];for(var i=!0,l=0;l<n.length;l++)(!1&a||o>=a)&&Object.keys(r.O).every((function(t){return r.O[t](n[l])}))?n.splice(l--,1):(i=!1,a<o&&(o=a));if(i){t.splice(d--,1);var c=s();void 0!==c&&(e=c)}}return e}a=a||0;for(var d=t.length;d>0&&t[d-1][2]>a;d--)t[d]=t[d-1];t[d]=[n,s,a]}}(),function(){r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,{a:e}),e}}(),function(){r.d=function(t,e){for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};r.O.j=function(e){return 0===t[e]};var e=function(e,n){var s,a,o=n[0],i=n[1],l=n[2],c=0;if(o.some((function(e){return 0!==t[e]}))){for(s in i)r.o(i,s)&&(r.m[s]=i[s]);if(l)var d=l(r)}for(e&&e(n);c<o.length;c++)a=o[c],r.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return r.O(d)},n=self["webpackChunkautocartest"]=self["webpackChunkautocartest"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=r.O(void 0,[998],(function(){return r(5603)}));n=r.O(n)})();
//# sourceMappingURL=app.33ad1f15.js.map